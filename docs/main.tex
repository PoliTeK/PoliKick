\documentclass{article}

% Useful packages
\usepackage{amsmath}  % improve math presentation
\usepackage{amssymb}
\usepackage[italian]{babel}
\usepackage{cancel}
\usepackage{caption}
\captionsetup{labelfont=bf, font=footnotesize}
\usepackage{circuitikz}
\usepackage{cite} % takes care of citations
\usepackage{enumitem}
\usepackage[final]{hyperref} % adds hyper links inside the generated pdf file
\hypersetup{
	colorlinks=true,       % false: boxed links; true: colored links
	linkcolor=blue,        % color of internal links
	citecolor=blue,        % color of links to bibliography
	filecolor=magenta,     % color of file links
	urlcolor=blue         
}
\usepackage[utf8]{inputenc}
\usepackage[letterpaper,top=2cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}
\usepackage{graphicx} % takes care of graphic including machinery
\usepackage{placeins} % better float control
\usepackage{siunitx}
\sisetup{
    sticky-per,
    per-mode=power,
    exponent-product=\cdot,
    forbid-literal-units,
    inline-per-mode=power,
    display-per-mode=fraction,
    uncertainty-mode=separate,
    output-decimal-marker={,}
}
\usepackage{standalone}
\usepackage{subcaption}
\usepackage{tabularx} % extra features for tabular environment

%

\title{PoliKick}
\author{Politek}

\begin{document}
\maketitle

\numberwithin{figure}{section}
\numberwithin{equation}{section}


\section{Introduzione}
In questo documento si studia il comportamento dei diversi blocchi che compongono il kick.

\section{Componenti}
\subsection{T-Oscillator}

\subsection{Gate to Trigger}

Per cominciare, studiamo il primo blocco del circuito. La tensione d'ingresso \(v_i\) è un segnale che proviene da un sequencer, pertanto sarà formato da una sequenza di porte rettangolari ("gate") (figura \ref{fig:sequencer-signal}).

\begin{figure}[ht]
    \centering
    \input{circuits/gate_to_trigger.tex}
    \label{fig:gate-to-trigger}
    \caption{Gate to Trigger}
\end{figure}

% TODO: inserire figura esempio del segnale sequencer
\begin{figure}[ht]
    \centering
    \label{fig:sequencer-signal}
\end{figure}

Ignoriamo inizialmente il diodo. Il segnale \(v_i\) viene immediatamente filtrato da un filtro RC passa-alto, pertanto la tensione \(v_+\) assume la caratteristica forma esponenziale ad ogni transizione di \(v_i\).
È utile introdurre il diodo \(D\) perché alcuni opamp soffrono di un effetto chiamato "phase inversion" se la tensione ai terminali diventa eccessivamente negativa; il compito del diodo è di bloccare la tensione su \(v_+\) ad un valore fisso durante la falling edge del segnale \(v_i\) (figura \ref{fig:sequencer-signal-hpf}).

% TODO: inserire figura
\begin{figure}[ht]
    \centering
    \label{fig:sequencer-signal-hpf}
\end{figure}

\subsection{T-Oscillator}
\subsubsection{Comportamento qualitativo nel dominio tempo}
\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{Toscillator.png} 
    \label{fig:Toscillator}
\end{figure}

Il Toscillator è un  circuito costituito da un solo amplificatore operazionale, due resistenze e due condensatori. Insieme formano un oscillatore a onda sinusoidale piuttosto strano che necessita di essere avviato con un impulso di tensione per iniziare a oscillare. Tuttavia, anche quando avviato, non continuerà a oscillare come fanno gli altri oscillatori, ma l'ampiezza calerà rapidamente fino a scomparire del tutto. Questo comportamento non è ideale per la maggior parte degli scenari, ma è perfetto per il nostro.Vediamo come funziona.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{Toscillator1.png} 
    \label{fig:Toscillator1}
\end{figure}

 Supponiamo che la tensione all'ingresso non invertente dell'op-amp salti rapidamente da 0 a 1 volt. Per raggiungere uno stato di equilibrio, l'op-amp cercherà di aumentare la tensione all'ingresso invertente fino a 1 volt anch'esso ( ricorda v+ = v- in un opamp). Per farlo, aumenterà inizialmente la sua tensione di uscita a 1 volt. Questo funzionerà all'inizio, poiché tale tensione attraversa direttamente i due condensatori e raggiunge così l'ingresso invertente. Tuttavia, a causa della presenza di una resistenza verso terra tra i due condensatori, vedremo una corrente che defluisce dal primo condensatore, il che significa che la tensione applicata al secondo condensatore, e successivamente all'ingresso invertente, diminuirà.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{Toscillator2.png} 
    \label{fig:Toscillator2}
\end{figure}

Per compensare, l'op-amp aumenterà la sua tensione di uscita, ma facendo ciò, ancora più corrente verrà spremuta fuori dal primo condensatore, costringendo l'op-amp a spingere ancora di più. Questo continuerebbe fino a quando l'op-amp raggiunge la tensione di alimentazione superiore, se non fosse per la resistenza di collegamento in retroazione. Man mano che l'op-amp spinge sempre più forte, quella resistenza permette una piccola corrente di caricare il secondo condensatore dall'altro lato. A un certo punto, questo processo aggiungerà più tensione sulla sinistra di quanta ne perderemo a destra, facendo sì che l'intero meccanismo si inverta.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{Toscillator3.png} 
    \label{fig:Toscillator3}
\end{figure}


L'op-amp inizierà a ridurre la sua tensione di uscita per cercare di correggere, ma il problema è che ciò sottrarrà corrente dal primo condensatore e successivamente dal lato terra, aumentando la tensione tra i due condensatori e quindi all'ingresso invertente, il che costringerà l'op-amp a ridurre ulteriormente la sua tensione di uscita. Alla fine raggiungeremo di nuovo un punto critico dove il meccanismo si invertirà, ma questa volta a una tensione di uscita leggermente inferiore. Questo accade perché ad ogni ciclo di carica e scarica perdiamo un po' del momento iniziale. 

\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\textwidth]{Toscillator4.png} 
    \label{fig:Toscillator4}
\end{figure}

Il circuito si comporta un po' come un pendolo, e quindi l'uscita prodotta è un'onda sinusoidale che oscilla attorno alla tensione dell'ingresso non invertente con un'ampiezza in continua diminuzione, che dovrebbe già suonare molto simile a un suono di grancassa se la frequenza è abbastanza bassa.
Per assicurarsi che lo sia, dobbiamo scegliere la giusta combinazione di valori per i condensatori e le resistenze. Questo è un po' complicato, poiché tutti questi valori influenzano sia la frequenza che il decadimento contemporaneamente. Nel circuito originale della grancassa dell'808, Roland utilizzava una resistenza di collegamento da 1 Megaohm, una resistenza verso terra da 51k e due condensatori da 15 nanofarad, ottenendo una frequenza di oscillazione di 50 hertz con un decadimento molto rapido. Usiamo questi valori come punto di partenza. 

\subsubsection{Dominio frequenza}

Il circuito in retroazione puo' essere visto come un filtro elimina banda  (notch filter) 
che quando viene inserito nella retroazione di un amplificatore operazionale, trasforma il sistema in un filtro passa-banda. Utilizzando le equazioni per la rete a T di ponte, si possono trovare la frequenza centrale e il fattore di qualità del filtro in base ai valori combinati di resistenze e condensatori.

\begin{equation}
    f = \frac{1}{2 \pi\sqrt{R_1 R_2 C_1 C_2}}
\end{equation}

\begin{equation}
    Q = \frac{\sqrt{\frac{R_1}{R_2}}}{\sqrt{\frac{C_1}{C_2}} + {\frac{C_2}{C_1}}}
\end{equation}


Per utilizzare il filtro passa-banda come oscillatore, devono essere soddisfatte due condizioni: il cambiamento di fase intorno al loop dell'amplificatore operazionale deve essere un multiplo di 360 gradi (incluso 0 gradi) e ci deve essere un guadagno sufficiente.
Nel circuito del filtro a T di ponte, l'uscita dell'amplificatore operazionale ha uno sfasamento di 0 gradi alla frequenza centrale. Pertanto, se calcoliamo una frequenza centrale per una certa frequenza dell'oscillatore desiderata, possiamo scegliere i valori corretti dei componenti per ottenere quella frequenza centrale, che ci darà uno sfasamento di 0 gradi a quella frequenza. 

\begin{figure}[htp]
    \centering
    \includegraphics[width=\textwidth]{notch2.png} 
    \caption{notch filter}
    \label{fig:Notch-filter}
\end{figure}

\begin{figure}[htp]
    \centering
    \includegraphics[width=\textwidth]{toscillatorefrequency.png} 
    \caption{T-oscillator}
    \label{fig:Toscillator-plot}
\end{figure}

\subsection{Gate to Trigger}
\subsubsection{Scopo}

\begin{figure}[htp]
    \centering
    \includegraphics[width=0.7\textwidth]{gatebase.png} 
    \caption{gate to trigger}
    \label{fig:gate to trigger}
\end{figure}
L'obbiettivo di questa sezione di Circuito è Condizionare 


\end{document}

//Il blocco base consiste in un filtro passa alto e un comparatore (tensione soglia 3V). 
Quando applichiamo un onda quadra  il condensatore si carica fino a 5 V e poi tramite la resitenza al ground si scarica. La velocita' di scarica dipende dalla capacita del condensatore piu e' alta piu' tempo ci impiega. Quando la tensione sulla resitenza e' maggiore di quella del morsetto invertente 3V l'uscita dell'opamp va al max ovvero 12 V, mentre se minore a -12V (ricorda alimentazione).
Avendo bisogno di un impulso in uscita andiamo a prendere un condensatore con capacita piccola. Di conseguenza l'intervallo di tempo dove la tensione sulla resistenza e' maggiore di 3V sara' breve e quindi avremo in uscita un impulso.//